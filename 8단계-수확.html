<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆëŠ˜ ìƒì‚°ë¹„ ì¡°ì‚¬ - 8ë‹¨ê³„: ìˆ˜í™•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-gradient-to-br from-yellow-50 to-yellow-100 min-h-screen">
    <div id="app"></div>
    <script>
        const surveyState = {
            view: 'list',
            formData: {},
            phoneNumber: '',
            stage: 8,
            records: [],
            editingId: null
        };

        const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbxyddb2aW1WXORKjC0oJsabEPKX1_KgGT_xpg4Op2O2Zm1QiHUWl9XZyjjAuWevwm2w/exec';

        // ì‘ì—… ì¢…ë¥˜ë³„ ë°©ë²• ì˜µì…˜
        const methodOptions = {
            'êµ´ì·¨': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'í™í„¸ê¸°': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'ì£¼ëŒ€ìë¥´ê¸°': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'ë‹´ê¸°': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'ìˆ˜í™• í›„ ê±´ì¡°': ['ê±´ì¡°ì¥ ìœ„íƒ', 'ë³¸ì¸ê±´ì¡°ê¸° ì‚¬ìš©', 'ì„ í’ê¸° ì‚¬ìš©', 'ìì—°ê±´ì¡°'],
            'ì„ ë³„': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'í¬ì¥(ë§ì‘ì—…)': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ìê°€ ì‘ì—… (ì§ì ‘ í•¨)'],
            'ì¶œí•˜': ['ìœ„íƒ (ë‚¨ì—ê²Œ ë§¡ê¹€)', 'ì§ì ‘ ìš´ì†¡']
        };

        function updateFormFields(workType) {
            const methodContainer = document.getElementById('methodContainer');
            const harvestAmountContainer = document.getElementById('harvestAmountContainer');
            const transportCostContainer = document.getElementById('transportCostContainer');
            
            // ì‘ì—… ë°©ë²• í•„ë“œ
            if (methodOptions[workType] && methodOptions[workType].length > 0) {
                methodContainer.style.display = 'block';
                const methodSelect = document.getElementById('method');
                methodSelect.innerHTML = '<option value="">ì„ íƒí•˜ì„¸ìš”</option>' + 
                    methodOptions[workType].map(option => `<option value="${option}">${option}</option>`).join('');
            } else {
                methodContainer.style.display = 'none';
            }
            
            // ì´ ìˆ˜í™•ëŸ‰ í•„ë“œ (êµ´ì·¨ ì‘ì—…ì¼ ë•Œë§Œ í‘œì‹œ)
            if (workType === 'êµ´ì·¨') {
                harvestAmountContainer.style.display = 'block';
            } else {
                harvestAmountContainer.style.display = 'none';
            }
            
            // ìš´ì†¡ë¹„(ìœ ë¥˜ë¹„) í•„ë“œ (ì¶œí•˜ ì‘ì—…ì¼ ë•Œë§Œ í‘œì‹œ)
            if (workType === 'ì¶œí•˜') {
                transportCostContainer.style.display = 'block';
            } else {
                transportCostContainer.style.display = 'none';
            }
        }

        function saveData() {
            if (surveyState.phoneNumber) {
                const dataToSave = {
                    stage_8_records: surveyState.records,
                    stage_8_summary: calculateSummary(),
                    completed_stage_8: surveyState.formData.completed_stage_8 || false,
                    savedAt: new Date().toISOString(),
                    stage: surveyState.stage,
                    phoneNumber: surveyState.phoneNumber
                };
                
                const allData = localStorage.getItem(`garlic_survey_${surveyState.phoneNumber}`);
                const parsed = allData ? JSON.parse(allData) : {};
                Object.assign(parsed, dataToSave);
                
                localStorage.setItem(`garlic_survey_${surveyState.phoneNumber}`, JSON.stringify(parsed));
            }
        }

        function loadData() {
            if (surveyState.phoneNumber) {
                const savedData = localStorage.getItem(`garlic_survey_${surveyState.phoneNumber}`);
                if (savedData) {
                    const parsed = JSON.parse(savedData);
                    surveyState.records = parsed.stage_8_records || [];
                    surveyState.formData = parsed;
                    return true;
                }
            }
            return false;
        }

        function calculateSummary() {
            const totalRecords = surveyState.records.length;
            const totalMaterialCost = surveyState.records.reduce((sum, r) => sum + (parseInt(r.material_cost) || 0), 0);
            const totalLaborCost = surveyState.records.reduce((sum, r) => sum + (parseInt(r.labor_cost) || 0), 0);
            
            return {
                total_records: totalRecords,
                total_material_cost: totalMaterialCost,
                total_labor_cost: totalLaborCost,
                total_cost: totalMaterialCost + totalLaborCost
            };
        }

        function addOrUpdateRecord(recordData) {
            if (surveyState.editingId !== null) {
                const index = surveyState.records.findIndex(r => r.id === surveyState.editingId);
                if (index !== -1) {
                    surveyState.records[index] = { ...recordData, id: surveyState.editingId };
                }
                surveyState.editingId = null;
            } else {
                const newId = surveyState.records.length > 0 
                    ? Math.max(...surveyState.records.map(r => r.id)) + 1 
                    : 1;
                surveyState.records.push({ ...recordData, id: newId });
            }
            saveData();
            surveyState.view = 'list';
            render();
        }

        function editRecord(id) {
            surveyState.editingId = id;
            surveyState.view = 'form';
            render();
        }

        function deleteRecord(id) {
            if (confirm('ì´ ì‘ì—… ê¸°ë¡ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                surveyState.records = surveyState.records.filter(r => r.id !== id);
                saveData();
                render();
            }
        }

        function showAddForm() {
            surveyState.editingId = null;
            surveyState.view = 'form';
            render();
        }

        function cancelForm() {
            surveyState.editingId = null;
            surveyState.view = 'list';
            render();
        }

        async function submitStage() {
            if (surveyState.records.length === 0) {
                alert('âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì‘ì—…ì„ ê¸°ë¡í•´ì•¼ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.');
                return;
            }

            const summary = calculateSummary();
            
            const submitData = {
                timestamp: new Date().toISOString(),
                phoneNumber: surveyState.phoneNumber,
                stage: 8,
                stage_8_records: surveyState.records,
                stage_8_summary: summary,
                completed_stage_8: true
            };

            try {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(submitData)
                });

                surveyState.formData.completed_stage_8 = true;
                saveData();

                alert('âœ… 8ë‹¨ê³„ê°€ ì œì¶œë˜ì—ˆìŠµë‹ˆë‹¤!\n\në©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ì„¸ìš”.');
                window.location.href = 'index.html';
            } catch (error) {
                console.error('ì œì¶œ ì˜¤ë¥˜:', error);
                alert('âœ… 8ë‹¨ê³„ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!\n\në©”ì¸ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ ë‹¤ìŒ ë‹¨ê³„ë¥¼ ì§„í–‰í•˜ì„¸ìš”.');
                window.location.href = 'index.html';
            }
        }

        function handleFormSubmit(event) {
            event.preventDefault();
            
            const workType = document.querySelector('input[name="work_type"]:checked')?.value;
            
            if (!workType) {
                alert('ì‘ì—… ì¢…ë¥˜ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            const formData = {
                date: document.getElementById('date').value,
                work_type: workType,
                material_cost: document.getElementById('material_cost').value || '0',
                labor_cost: document.getElementById('labor_cost').value || '0',
                memo: document.getElementById('memo').value
            };

            // ì‘ì—… ë°©ë²•ì´ ìˆëŠ” ê²½ìš°
            if (methodOptions[workType] && methodOptions[workType].length > 0) {
                formData.method = document.getElementById('method').value;
                if (!formData.method) {
                    alert('ì‘ì—… ë°©ë²•ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // êµ´ì·¨ ì‘ì—…ì¸ ê²½ìš° ì´ ìˆ˜í™•ëŸ‰ í•„ìˆ˜
            if (workType === 'êµ´ì·¨') {
                formData.harvest_amount = document.getElementById('harvest_amount').value;
                if (!formData.harvest_amount) {
                    alert('ì´ ìˆ˜í™•ëŸ‰ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            // ì¶œí•˜ ì‘ì—…ì¸ ê²½ìš° ìš´ì†¡ë¹„ í•„ìˆ˜
            if (workType === 'ì¶œí•˜') {
                formData.transport_cost = document.getElementById('transport_cost').value;
                if (!formData.transport_cost) {
                    alert('ìš´ì†¡ë¹„(ìœ ë¥˜ë¹„)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                    return;
                }
            }

            addOrUpdateRecord(formData);
        }

        function render() {
            const app = document.getElementById('app');
            const savedPhone = localStorage.getItem('garlic_survey_phone');
            
            if (!savedPhone) {
                app.innerHTML = `
                    <div class="min-h-screen flex items-center justify-center p-4">
                        <div class="max-w-md w-full bg-white rounded-lg shadow-lg p-8 text-center">
                            <div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto mb-4">
                                <span class="text-4xl">âš ï¸</span>
                            </div>
                            <h2 class="text-2xl font-bold text-gray-800 mb-4">ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h2>
                            <p class="text-gray-600 mb-6">ë¨¼ì € ë©”ì¸ í™”ë©´ì—ì„œ ì „í™”ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.</p>
                            <a href="index.html" class="inline-block px-6 py-3 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700">ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™</a>
                        </div>
                    </div>
                `;
                return;
            }

            if (!surveyState.phoneNumber) {
                surveyState.phoneNumber = savedPhone;
                loadData();
            }

            if (surveyState.view === 'intro') {
                renderIntro(app);
            } else if (surveyState.view === 'list') {
                renderList(app);
            } else if (surveyState.view === 'form') {
                renderForm(app);
            }
        }

        function renderIntro(app) {
            app.innerHTML = `
                <div class="min-h-screen flex items-center justify-center p-4">
                    <div class="max-w-2xl w-full bg-white rounded-lg shadow-lg p-8 text-center space-y-6 fade-in">
                        <div class="bg-yellow-100 rounded-full w-20 h-20 flex items-center justify-center mx-auto">
                            <span class="text-4xl">âš¡</span>
                        </div>
                        <h1 class="text-3xl font-bold text-gray-800">ë§ˆëŠ˜ ìƒì‚°ë¹„ ì¡°ì‚¬</h1>
                        <p class="text-xl text-yellow-600 font-medium">8ë‹¨ê³„: ìˆ˜í™•</p>
                        <p class="text-gray-600">ìˆ˜í™•, ê±´ì¡°, ì„ ë³„, í¬ì¥, ì¶œí•˜ ì‘ì—…ì„ ì‘ì—…ì¼ì§€ ë°©ì‹ìœ¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤.</p>
                        
                        <div class="bg-blue-50 p-6 rounded-lg text-left">
                            <h3 class="font-bold text-gray-800 mb-3">ğŸ“ ì‘ì—… ë°©ì‹ ì•ˆë‚´</h3>
                            <ul class="text-sm text-gray-700 space-y-2">
                                <li>âœ… ê° ì‘ì—…ë§ˆë‹¤ ê¸°ë¡ ì¶”ê°€</li>
                                <li>âœ… ë‚ ì§œ, ì‘ì—…ì¢…ë¥˜, ë¹„ìš© ì…ë ¥</li>
                                <li>âœ… ì–¸ì œë“ ì§€ ì¶”ê°€/ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥</li>
                                <li>âœ… ìµœì†Œ 1ê°œ ì´ìƒ ê¸°ë¡ í›„ ì œì¶œ</li>
                            </ul>
                        </div>
                        <div class="flex gap-4 justify-center">
                            <a href="index.html" class="px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300">â† ë©”ì¸ìœ¼ë¡œ</a>
                            <button onclick="surveyState.view = 'list'; render();" class="px-8 py-3 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700 text-lg">ì‹œì‘í•˜ê¸° â†’</button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderList(app) {
            const summary = calculateSummary();
            const isAlreadySubmitted = surveyState.formData.completed_stage_8;
            
            const recordsHTML = surveyState.records.length > 0 
                ? surveyState.records.map(record => `
                    <div class="bg-gray-50 p-4 rounded-lg border-2 border-gray-200">
                        <div class="flex justify-between items-start mb-2">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <span class="text-lg font-bold text-yellow-600">${record.work_type}</span>
                                    <span class="text-sm text-gray-500">${record.date}</span>
                                </div>
                                <div class="text-sm text-gray-700 space-y-1">
                                    ${record.method ? `<p>ğŸ”§ ì‘ì—…ë°©ë²•: ${record.method}</p>` : ''}
                                    ${record.harvest_amount ? `<p>âš–ï¸ ì´ ìˆ˜í™•ëŸ‰: ${parseFloat(record.harvest_amount)}kg</p>` : ''}
                                    ${record.transport_cost ? `<p>ğŸšš ìš´ì†¡ë¹„(ìœ ë¥˜ë¹„): ${parseInt(record.transport_cost).toLocaleString()}ì›</p>` : ''}
                                    <p>ğŸ’° ìì¬ë¹„: ${parseInt(record.material_cost).toLocaleString()}ì›</p>
                                    ${record.labor_cost && parseInt(record.labor_cost) > 0 ? `<p>ğŸ‘· ì¸ê±´ë¹„: ${parseInt(record.labor_cost).toLocaleString()}ì›</p>` : ''}
                                    ${record.memo ? `<p>ğŸ“ ${record.memo}</p>` : ''}
                                </div>
                            </div>
                            <div class="flex gap-2">
                                <button onclick="editRecord(${record.id})" class="px-3 py-1 bg-blue-500 text-white text-sm rounded hover:bg-blue-600">ìˆ˜ì •</button>
                                <button onclick="deleteRecord(${record.id})" class="px-3 py-1 bg-red-500 text-white text-sm rounded hover:bg-red-600">ì‚­ì œ</button>
                            </div>
                        </div>
                    </div>
                `).join('')
                : '<div class="text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300"><p class="text-gray-500 mb-4">ğŸ“ ì•„ì§ ê¸°ë¡ëœ ì‘ì—…ì´ ì—†ìŠµë‹ˆë‹¤</p><p class="text-sm text-gray-400">ì‘ì—…ì„ ì§„í–‰í•˜ì‹¤ ë•Œë§ˆë‹¤ ê¸°ë¡í•´ì£¼ì„¸ìš”</p></div>';

            app.innerHTML = `
                <div class="min-h-screen p-4">
                    <div class="max-w-3xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-4 md:p-6 mb-4">
                            <div class="flex justify-between items-center">
                                <div>
                                    <h1 class="text-lg md:text-2xl font-bold text-gray-800">ë§ˆëŠ˜ ìƒì‚°ë¹„ ì¡°ì‚¬</h1>
                                    <p class="text-sm text-yellow-600">8ë‹¨ê³„: ìˆ˜í™•</p>
                                </div>
                                <div class="flex gap-2">
                                    <a href="index.html" class="px-3 py-2 bg-gray-200 text-gray-700 rounded-lg text-sm hover:bg-gray-300">ë©”ì¸</a>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-lg shadow-lg p-6 mb-4">
                            <div class="flex justify-between items-center mb-4">
                                <h2 class="text-xl font-bold text-gray-800">ğŸ“ ì‘ì—… ê¸°ë¡</h2>
                                <button onclick="showAddForm()" class="px-4 py-2 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700">
                                    + ìƒˆ ì‘ì—… ê¸°ë¡í•˜ê¸°
                                </button>
                            </div>

                            ${isAlreadySubmitted ? '<div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-4"><p class="text-sm text-gray-700">âœ… <strong>ì´ë¯¸ ì œì¶œëœ ë‹¨ê³„ì…ë‹ˆë‹¤</strong><br>ì¶”ê°€ ì‘ì—…ì„ ê¸°ë¡í•˜ê³  "ë‹¤ì‹œ ì œì¶œí•˜ê¸°"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.</p></div>' : ''}

                            <div class="space-y-3">
                                ${recordsHTML}
                            </div>
                        </div>

                        ${surveyState.records.length > 0 ? `
                        <div class="bg-white rounded-lg shadow-lg p-6 mb-4">
                            <h3 class="font-bold text-gray-800 mb-3">ğŸ’° ë¹„ìš© í•©ê³„</h3>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-center">
                                <div class="bg-blue-50 p-4 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">ì‘ì—… íšŸìˆ˜</p>
                                    <p class="text-2xl font-bold text-blue-600">${summary.total_records}íšŒ</p>
                                </div>
                                <div class="bg-green-50 p-4 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">ìì¬ë¹„</p>
                                    <p class="text-lg font-bold text-green-600">${summary.total_material_cost.toLocaleString()}ì›</p>
                                </div>
                                <div class="bg-purple-50 p-4 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">ì¸ê±´ë¹„</p>
                                    <p class="text-lg font-bold text-purple-600">${summary.total_labor_cost.toLocaleString()}ì›</p>
                                </div>
                                <div class="bg-yellow-50 p-4 rounded-lg">
                                    <p class="text-sm text-gray-600 mb-1">ì´ ë¹„ìš©</p>
                                    <p class="text-lg font-bold text-yellow-600">${summary.total_cost.toLocaleString()}ì›</p>
                                </div>
                            </div>
                        </div>
                        ` : ''}

                        <div class="bg-white rounded-lg shadow-lg p-6">
                            ${surveyState.records.length === 0 ? 
                                '<div class="bg-yellow-50 border-l-4 border-yellow-400 p-4 rounded mb-4"><p class="text-sm text-gray-700">âš ï¸ ìµœì†Œ 1ê°œ ì´ìƒì˜ ì‘ì—…ì„ ê¸°ë¡í•´ì•¼ ì œì¶œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p></div>' 
                                : ''}
                            <button 
                                onclick="submitStage()" 
                                class="w-full px-6 py-3 ${surveyState.records.length === 0 ? 'bg-gray-300 cursor-not-allowed' : isAlreadySubmitted ? 'bg-yellow-600 hover:bg-yellow-700' : 'bg-yellow-600 hover:bg-yellow-700'} text-white rounded-lg font-medium text-lg"
                                ${surveyState.records.length === 0 ? 'disabled' : ''}
                            >
                                ${isAlreadySubmitted ? 'ë‹¤ì‹œ ì œì¶œí•˜ê¸°' : 'ì œì¶œí•˜ê¸°'}
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderForm(app) {
            const editingRecord = surveyState.editingId !== null 
                ? surveyState.records.find(r => r.id === surveyState.editingId)
                : null;

            const today = new Date().toISOString().split('T')[0];

            const workTypes = ['êµ´ì·¨', 'í™í„¸ê¸°', 'ì£¼ëŒ€ìë¥´ê¸°', 'ë‹´ê¸°', 'ìˆ˜í™• í›„ ê±´ì¡°', 'ì„ ë³„', 'í¬ì¥(ë§ì‘ì—…)', 'ì¶œí•˜'];

            app.innerHTML = `
                <div class="min-h-screen p-4">
                    <div class="max-w-2xl mx-auto">
                        <div class="bg-white rounded-lg shadow-lg p-6">
                            <h2 class="text-2xl font-bold text-gray-800 mb-6">
                                ${editingRecord ? 'âœï¸ ì‘ì—… ê¸°ë¡ ìˆ˜ì •' : 'â• ìƒˆ ì‘ì—… ê¸°ë¡'}
                            </h2>

                            <form id="recordForm" onsubmit="handleFormSubmit(event)" class="space-y-6">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ“… ì‘ì—… ë‚ ì§œ <span class="text-red-500">*</span>
                                    </label>
                                    <input 
                                        type="date" 
                                        id="date"
                                        value="${editingRecord ? editingRecord.date : today}"
                                        max="${today}"
                                        required
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    />
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ“Œ ì‘ì—… ì¢…ë¥˜ <span class="text-red-500">*</span>
                                    </label>
                                    <div class="space-y-2">
                                        ${workTypes.map(type => `
                                            <label class="flex items-center space-x-3 p-3 border-2 rounded-lg cursor-pointer hover:bg-yellow-50 transition-colors ${editingRecord && editingRecord.work_type === type ? 'border-yellow-500 bg-yellow-50' : 'border-gray-300'}">
                                                <input 
                                                    type="radio" 
                                                    name="work_type" 
                                                    value="${type}"
                                                    ${editingRecord && editingRecord.work_type === type ? 'checked' : ''}
                                                    onchange="updateFormFields(this.value)"
                                                    class="w-5 h-5 text-yellow-600 focus:ring-yellow-500"
                                                />
                                                <span class="text-gray-800 font-medium">${type}</span>
                                            </label>
                                        `).join('')}
                                    </div>
                                </div>

                                <div id="methodContainer" style="display: none;">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ”§ ì‘ì—… ë°©ë²• <span class="text-red-500">*</span>
                                    </label>
                                    <select 
                                        id="method"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    >
                                        <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                                    </select>
                                </div>

                                <div id="harvestAmountContainer" style="display: none;">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        âš–ï¸ ì´ ìˆ˜í™•ëŸ‰ (kg) <span class="text-red-500">*</span>
                                    </label>
                                    <input 
                                        type="number" 
                                        id="harvest_amount"
                                        min="0"
                                        step="0.1"
                                        placeholder="ìˆ˜í™•í•œ ë§ˆëŠ˜ì˜ ì´ ë¬´ê²Œ"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">ìˆ˜í™•í•œ ë§ˆëŠ˜ì˜ ì´ ë¬´ê²Œ(kg)</p>
                                </div>

                                <div id="transportCostContainer" style="display: none;">
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸšš ìš´ì†¡ë¹„(ìœ ë¥˜ë¹„) (ì›) <span class="text-red-500">*</span>
                                    </label>
                                    <input 
                                        type="number" 
                                        id="transport_cost"
                                        min="0"
                                        placeholder="ìš´ì†¡ë¹„ ë˜ëŠ” ìœ ë¥˜ë¹„"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">ì¶œí•˜ ì‹œ ë°œìƒí•œ ìš´ì†¡ë¹„ ë˜ëŠ” ìœ ë¥˜ë¹„</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ’° ìì¬ë¹„ (ì›)
                                    </label>
                                    <input 
                                        type="number" 
                                        id="material_cost"
                                        value="${editingRecord ? editingRecord.material_cost : ''}"
                                        min="0"
                                        placeholder="ìì¬ êµ¬ì… ë¹„ìš©"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">ìì¬ êµ¬ì… ë¹„ìš©</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ‘· ì¸ê±´ë¹„ (ì›)
                                    </label>
                                    <input 
                                        type="number" 
                                        id="labor_cost"
                                        value="${editingRecord ? editingRecord.labor_cost : ''}"
                                        min="0"
                                        placeholder="ì‘ì—… ì¸ê±´ë¹„"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    />
                                    <p class="text-xs text-gray-500 mt-1">ì‘ì—… ì¸ê±´ë¹„ (ê³ ìš© ë˜ëŠ” ìœ„íƒ)</p>
                                </div>

                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">
                                        ğŸ“ ë©”ëª¨ (ì„ íƒì‚¬í•­)
                                    </label>
                                    <textarea 
                                        id="memo"
                                        rows="3"
                                        placeholder="ì•½ì¬ëª…, ìì¬ëª…, ì‚¬ìš©ëŸ‰ ë“±ì„ ê¸°ë¡í•˜ì„¸ìš”&#10;ì˜ˆ: ìˆ˜í™•ëŸ‰ 3,000kg, í¬ì¥ì¬ 500ê°œ, ì¶œí•˜ì²˜ ë†í˜‘"
                                        class="w-full p-3 border-2 border-gray-300 rounded-lg focus:border-yellow-500 focus:outline-none"
                                    >${editingRecord ? editingRecord.memo : ''}</textarea>
                                </div>

                                <div class="flex gap-4">
                                    <button 
                                        type="button"
                                        onclick="cancelForm()"
                                        class="flex-1 px-6 py-3 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300"
                                    >
                                        ì·¨ì†Œ
                                    </button>
                                    <button 
                                        type="submit"
                                        class="flex-1 px-6 py-3 bg-yellow-600 text-white rounded-lg font-medium hover:bg-yellow-700"
                                    >
                                        ${editingRecord ? 'ìˆ˜ì • ì™„ë£Œ' : 'ê¸°ë¡ ì¶”ê°€'}
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            `;

            // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ í•„ë“œ ì´ˆê¸°í™”
            if (editingRecord && editingRecord.work_type) {
                setTimeout(() => {
                    updateFormFields(editingRecord.work_type);
                    
                    // ì‘ì—… ë°©ë²• ì„¤ì •
                    if (editingRecord.method) {
                        const methodSelect = document.getElementById('method');
                        if (methodSelect) methodSelect.value = editingRecord.method;
                    }
                    
                    // ì´ ìˆ˜í™•ëŸ‰ ì„¤ì •
                    if (editingRecord.harvest_amount) {
                        const harvestAmount = document.getElementById('harvest_amount');
                        if (harvestAmount) harvestAmount.value = editingRecord.harvest_amount;
                    }
                    
                    // ìš´ì†¡ë¹„ ì„¤ì •
                    if (editingRecord.transport_cost) {
                        const transportCost = document.getElementById('transport_cost');
                        if (transportCost) transportCost.value = editingRecord.transport_cost;
                    }
                }, 50);
            }
        }

        surveyState.view = 'intro';
        render();
    </script>
</body>
</html>
